<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>å‰‘æ¡¥ä¸€çº§å•è¯å­¦ä¹ ç³»ç»Ÿ</title>
<style>
body{font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",Arial,sans-serif;background:#f8f9fa;color:#333;padding:20px;max-width:800px;margin:auto}
h1{text-align:center;margin-bottom:30px;font-weight:700;color:#ff6f00} /* æ›´æ´»æ³¼çš„æ ‡é¢˜é¢œè‰² */
.nav-tabs{display:flex;justify-content:center;margin-bottom:30px;border-bottom:1px solid #b2ebf2}
.nav-tab{padding:12px 24px;margin:0 5px;background:transparent;border:none;border-bottom:3px solid transparent;cursor:pointer;font-size:18px;color:#00796b;transition:all .3s} /* è°ƒæ•´å­—å·å’Œé¢œè‰² */
.nav-tab.active{color:#00bcd4;border-bottom-color:#00bcd4} /* è°ƒæ•´é€‰ä¸­é¢œè‰² */
.content-section{display:none;background:#fff;padding:30px;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,.08)}
.content-section.active{display:block}
.category-btn{padding:12px 22px;margin:8px;background:#e0f2f7;border:none;border-radius:10px;cursor:pointer;font-size:18px;transition:all .3s;color:#006064} /* è°ƒæ•´æ ·å¼å’Œå­—å· */
.category-btn.selected{background:#00bcd4;color:#fff;box-shadow:0 4px 6px rgba(0,188,212,.3)} /* è°ƒæ•´é€‰ä¸­é¢œè‰² */
.word-item-row{display:flex;align-items:center;padding:12px 24px;margin:10px;background:#f5f5f5;border-radius:10px;cursor:pointer;font-size:22px;transition:all .3s;border:1px solid #e0e0e0;box-shadow:0 2px 5px rgba(0,0,0,.05)} /* è°ƒæ•´å­—å·å’Œæ ·å¼ */
.word-item-row:hover{background:#00bcd4;color:#fff;transform:translateY(-2px);box-shadow:0 4px 10px rgba(0,188,212,.3)}
.word-en{font-weight:600;margin-right:15px;color:#004d40}          /* æ·±ç»¿è‰²è‹±æ–‡ */
.word-cn{font-weight:500;margin-left:auto;color:#006064}       /* è“è‰²ä¸­æ–‡ */

#backToTop{position:fixed;bottom:30px;right:30px;padding:12px 16px;background:#ff6f00;color:#fff;border:none;border-radius:50%;cursor:pointer;font-size:24px;box-shadow:0 4px 8px rgba(0,0,0,.2);display:none;z-index:1000} /* è°ƒæ•´æ ·å¼ */
#backToTop:hover{background:#e65100}

/* å°æµ‹ UI è¿˜åŸ */
.quiz-option{padding:16px;background:#e0f7fa;border:1px solid #b2ebf2;border-radius:8px;cursor:pointer;text-align:center;font-size:20px;transition:all .3s;margin:8px;color:#004d40} /* è°ƒæ•´å­—å·å’Œé¢œè‰² */
.quiz-option:hover{border-color:#00bcd4;background:#e0f2f7}
.quiz-option.correct{background:#e8f5e9;border-color:#4caf50;color:#4caf50} /* è°ƒæ•´é¢œè‰² */
.quiz-option.wrong{background:#ffebee;border-color:#f44336;color:#f44336} /* è°ƒæ•´é¢œè‰² */
.quiz-setup select,.quiz-setup button{padding:10px 14px;font-size:18px;border-radius:8px;border:1px solid #b2ebf2} /* è°ƒæ•´æ ·å¼ */

/* æ‹¼å†™æ¨ªçº¿+å­—æ¯ç¾åŒ– */
.spelling-display-lines{display:flex;gap:10px;justify-content:center;margin:25px 0}
.letter-slot{width:50px;height:65px;border-bottom:4px solid #00bcd4;font-size:32px;font-weight:700;text-align:center;line-height:60px;color:#263238;background:#fff;border-radius:6px;box-shadow:0 3px 6px rgba(0,0,0,.15)} /* è°ƒæ•´å­—å·å’Œæ ·å¼ */
.letter-slot.filled{border-color:#4caf50;color:#4caf50} /* è°ƒæ•´é¢œè‰² */
.letter-btn{padding:16px 22px;margin:8px;font-size:24px;font-weight:500;background:#e0f2f7;border:1px solid #b2ebf2;border-radius:10px;cursor:pointer;transition:all .3s;min-width:60px;color:#006064} /* è°ƒæ•´å­—å·å’Œæ ·å¼ */
.letter-btn:hover{background:#b2ebf2;border-color:#00bcd4;transform:translateY(-3px)}
.letter-btn.used{background:#00bcd4;color:#fff;border-color:#00bcd4} /* è°ƒæ•´é¢œè‰² */

/* æäº¤æŒ‰é’®å­—å· */
#spellingContent .primary-btn{font-size:24px;padding:12px 26px;border-radius:10px}

/* ç­”å¯¹/ç­”é”™æç¤º */
.message.success{background:#e8f5e9;border:2px solid #4caf50;color:#4caf50;font-size:24px;font-weight:700;text-transform:uppercase;padding:15px;border-radius:8px} /* è°ƒæ•´å­—å·å’Œæ ·å¼ */
.message.error{background:#ffebee;border:2px solid #f44336;color:#f44336;font-size:22px;padding:15px;border-radius:8px} /* è°ƒæ•´å­—å·å’Œæ ·å¼ */

/* ä¸­æ–‡æ ‡é¢˜+å¡é€šå–‡å­ */
.spelling-title{font-size:40px;font-weight:800;color:#ff6f00;text-align:center;margin:15px 0 15px} /* è°ƒæ•´å­—å·å’Œé¢œè‰² */
.cartoon-speaker{font-size:48px;background:linear-gradient(135deg,#ffab40,#ff6f00);border:none;border-radius:50%;width:80px;height:80px;cursor:pointer;margin:0 auto 25px;display:block;box-shadow:0 6px 12px rgba(0,0,0,.25);transition:transform .2s} /* è°ƒæ•´æ ·å¼ */
.cartoon-speaker:hover{transform:scale(1.15)}

/* åˆ¶ä½œäººå±…ä¸­ */
.footer{text-align:center;margin:60px 0 25px;color:#78909c;font-size:18px} /* è°ƒæ•´å­—å·å’Œé¢œè‰² */
</style>
</head>
<body>
<h1>å‰‘æ¡¥ä¸€çº§å•è¯å­¦ä¹ ç³»ç»Ÿ</h1>

<div class="nav-tabs">
  <button class="nav-tab active" onclick="showSection('learning')">å•è¯å­¦ä¹ </button>
  <button class="nav-tab" onclick="showSection('quiz')">å•è¯å°æµ‹</button>
  <button class="nav-tab" onclick="showSection('spelling')">æ‹¼å†™æ¸¸æˆ</button>
</div>

<!-- å•è¯å­¦ä¹  -->
<div id="learning" class="content-section active">
  <div class="category-selector"><h3>é€‰æ‹©åˆ†ç±»ï¼š</h3><div id="learningCategories"></div></div>
  <div id="wordList"></div>
  <button id="backToTop" onclick="scrollToTop()">â†‘</button>
</div>

<!-- å•è¯å°æµ‹ -->
<div id="quiz" class="content-section">
  <div class="quiz-setup">
    <div><label>é€‰æ‹©åˆ†ç±»ï¼š</label><select id="quizCategory"></select></div>
    <div style="margin-top:15px;"><label>æµ‹è¯•æ¨¡å¼ï¼š</label>
      <select id="quizMode"><option value="cn2en">ä¸­è¯‘è‹±</option><option value="en2cn">è‹±è¯‘ä¸­</option></select>
    </div>
    <div style="margin-top:15px;"><label>é€‰é¡¹æ•°é‡ï¼š</label>
      <select id="quizOptions"><option value="3">3é€‰1</option><option value="4">4é€‰1</option></select>
    </div>
    <button class="primary-btn" onclick="startQuiz()" style="background-color: #4CAF50; color: #fff;">å¼€å§‹æµ‹è¯•</button>
    <button class="primary-btn" onclick="startQuiz('review')" style="margin-left: 10px; background-color: #2196F3; color: #fff;">å¤ä¹ é”™é¢˜</button>
    <button class="primary-btn" onclick="clearQuizWrongWords()" style="margin-left: 10px; background-color: #f44336; color: #fff;">æ¸…ç©ºé”™é¢˜</button>
  </div>
  <div id="quizContent" style="display:none;">
    <div id="quizQuestion" style="text-align:center;font-size:24px;margin-bottom:20px;"></div>
    <div id="quizOptionsContainer" class="quiz-options"></div>
    <div class="stats">
      å·²åšï¼š<span id="quizTotal">0</span>ã€€æ­£ç¡®ï¼š<span id="quizCorrect">0</span>ã€€é”™è¯¯ï¼š<span id="quizWrong">0</span>ã€€æ­£ç¡®ç‡ï¼š<span id="quizRate">0%</span>
    </div>
    <div id="quizMessage" style="text-align:center; margin-top: 20px;"></div>
  </div>

  <div id="quizWrongWordsDisplay" style="margin-top: 30px; padding: 20px; background: #fff; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,.08); display: none;">
    <h3>å°æµ‹ç­”é”™çš„å•è¯ï¼š</h3>
    <ul id="quizWrongWordsList"></ul>
  </div>
</div>

<!-- æ‹¼å†™æ¸¸æˆ -->
<div id="spelling" class="content-section">
  <div class="quiz-setup">
    <div><label class="spell-label">é€‰æ‹©åˆ†ç±»ï¼š</label><select id="spellingCategory" class="spell-select"></select></div>
    <div style="margin-top:15px;"><label class="spell-label">å­—æ¯å¤§å°å†™ï¼š</label>
      <select id="letterCase" class="spell-select"><option value="upper">å¤§å†™</option><option value="lower">å°å†™</option></select>
    </div>
    <div style="margin-top:15px;"><label class="spell-label">å¹²æ‰°å­—æ¯æ•°é‡ï¼š</label>
      <select id="distractionLetters" class="spell-select"><option value="0">0ä¸ª</option><option value="1">1ä¸ª</option><option value="2">2ä¸ª</option><option value="3">3ä¸ª</option></select>
    </div>
    <div style="margin-top:15px;"><label class="spell-label">ä»å“ªä¸ªå•è¯å¼€å§‹å¬å†™ï¼š</label>
      <select id="startWord" class="spell-select"></select>
    </div>
    <button class="primary-btn" onclick="startSpelling()" style="background-color: #4CAF50; color: #fff;">å¼€å§‹æ‹¼å†™</button>
    <button class="primary-btn" onclick="startSpelling('review')" style="margin-left: 10px; background-color: #2196F3; color: #fff;">å¤ä¹ é”™é¢˜</button>
    <button class="primary-btn" onclick="clearWrongWords()" style="margin-left: 10px; background-color: #f44336; color: #fff;">æ¸…ç©ºé”™é¢˜</button>
  </div>
  <div id="spellingContent" class="spelling-container" style="display:none;">
    <div id="spellingWord" class="spelling-title"></div>
    <button class="cartoon-speaker" onclick="speakWord(currentSpellWord)">ğŸº</button>
    <div id="spellingDisplay" class="spelling-display-lines"></div>
    <div id="letterButtons" class="letter-buttons"></div>
    <button class="primary-btn" onclick="checkSpelling()">æäº¤ç­”æ¡ˆ</button>
    <div class="stats">
      å·²åšï¼š<span id="spellTotal">0</span>ã€€æ­£ç¡®ï¼š<span id="spellCorrect">0</span>ã€€é”™è¯¯ï¼š<span id="spellWrong">0</span>ã€€æ­£ç¡®ç‡ï¼š<span id="spellRate">0%</span>
    </div>
    <div id="spellingMessage"></div>
  </div>

  <div id="wrongWordsDisplay" style="margin-top: 30px; padding: 20px; background: #fff; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,.05); display: none;">
    <h3>ç­”é”™çš„å•è¯ï¼š</h3>
    <ul id="wrongWordsList"></ul>
  </div>
</div>

<div class="footer">åˆ¶ä½œäººï¼šKimi AI<br>å°å­¦éƒ¨å­”å¾·æ™–</div>

<script>
/* ========== å•è¯åº“ ========== */
const wordData = {
  Animal: {
    words: ['animal', 'bear', 'bee', 'bird', 'cat', 'chicken', 'cow', 'crocodile', 'dog', 'donkey', 'duck', 'elephant', 'fish', 'frog', 'giraffe', 'goat', 'hippo', 'horse', 'jellyfish', 'lizard', 'monkey', 'mouse/mice', 'pet', 'polar bear', 'sheep', 'snake', 'spider', 'tail', 'tiger', 'zebra', 'zoo' ],
    meanings: ['åŠ¨ç‰©', 'ç†Š', 'èœœèœ‚', 'é¸Ÿ', 'çŒ«', 'å°é¸¡', 'å¥¶ç‰›', 'é³„é±¼', 'ç‹—', 'é©´', 'é¸­å­', 'å¤§è±¡', 'é±¼', 'é’è›™', 'é•¿é¢ˆé¹¿', 'å±±ç¾Š', 'æ²³é©¬', 'é©¬', 'æ°´æ¯', 'èœ¥èœ´', 'çŒ´å­', 'è€é¼ ', 'å® ç‰©', 'åŒ—æç†Š', 'ç»µç¾Š', 'è›‡', 'èœ˜è››', 'å°¾å·´', 'è€è™', 'æ–‘é©¬', 'åŠ¨ç‰©å›­']
  },
  'The body and face':{
    words: ['arm', 'body', 'ear', 'eye', 'face', 'foot/feet', 'hair', 'hand', 'head', 'leg', 'mouth', 'nose', 'smile', ],
    meanings:[ 'æ‰‹è‡‚', 'èº«ä½“', 'è€³', 'çœ¼', 'è„¸', 'è„š', 'å¤´å‘', 'æ‰‹', 'å¤´', 'è…¿', 'å˜´', 'é¼»å­', 'å¾®ç¬‘']
  },
  Clothes:{
    words: ['bag', 'baseball cap', 'boots', 'clothes', 'dress', 'glasses', 'handbag', 'hat', 'jacket', 'jeans', 'shirt', 'shoe', 'shorts', 'skirt', 'sock', 'trousers', 'T-shirt', 'wear', ],
    meanings:['åŒ…', 'æ£’çƒå¸½', 'é´å­', 'è¡£æœ', 'é•¿è£™', 'çœ¼é•œ', 'æ‰‹è¢‹', 'å¸½', 'å¤¹å…‹', 'ç‰›ä»”è£¤', 'è¡¬è¡£', 'é‹', 'çŸ­è£¤', 'çŸ­è£™', 'è¢œ', 'é•¿è£¤', 'åœ†é¢†æ±—è¡«', 'ç©¿']
  },
  Colours:{
    words: ['black','blue','brown','colour','gray','green','grey','orange','pink','purple','red','white','yellow'],
    meanings:['é»‘è‰²','è“è‰²','æ£•è‰²','é¢œè‰²','ç°è‰²1','ç»¿è‰²','ç°è‰²2','æ¡”è‰²','ç²‰çº¢','ç´«è‰²','çº¢è‰²','ç™½è‰²','é»„è‰²']
  },
  'Family & friends':{
    words: ['baby', 'boy', 'brother', 'child', 'children', 'classmate', 'cousin', 'dad', 'family', 'father', 'friend', 'girl', 'grandfather', 'grandma', 'grandmother', 'grandpa', 'kid', 'live', 'man', 'men', 'mother', 'mum', 'old', 'person', 'people', 'sister', 'woman', 'women', 'young'],
    meanings:[ 'å©´å„¿', 'ç”·å­©', 'å…„å¼Ÿ', 'å°å­©ï¼ˆå•æ•°ï¼‰', 'å°å­©ï¼ˆå¤æ•°ï¼‰', 'åŒå­¦', 'å ‚å…„å¦¹', 'çˆ¸çˆ¸D', 'å®¶åº­', 'çˆ¶äº²F', 'æœ‹å‹', 'å¥³å­©', 'ç¥–çˆ¶f', 'å¥¶å¥¶', 'ç¥–æ¯', 'çˆ·çˆ·p', 'å°å­©K', 'å±…ä½', 'ç”·äººï¼ˆå•æ•°ï¼‰', 'ç”·äººï¼ˆå¤æ•°ï¼‰', 'æ¯äº²MO', 'å¦ˆå¦ˆMU', 'è€çš„', 'äººï¼ˆå•æ•°ï¼‰','äººï¼ˆå¤æ•°ï¼‰', 'å§å¦¹', 'å¥³äººï¼ˆå•æ•°ï¼‰', 'å¥³äººï¼ˆå¤æ•°ï¼‰', 'å¹´è½»çš„']
  },
  'Food & drink':{
    words: ['apple', 'banana', 'bean', 'bread', 'breakfast', 'burger', 'cake', 'candy', 'carrot', 'chicken', 'chips', 'chocolate', 'coconut', 'dinner', 'drink', 'eat', 'egg', 'fish', 'food', 'fries', 'fruit', 'grape', 'ice cream', 'juice', 'kiwi', 'lemon', 'lemonade', 'lime', 'lunch', 'mango', 'meat', 'meatballs', 'milk', 'onion', 'orange', 'pea', 'pear', 'pie', 'pineapple', 'potato', 'rice', 'sausage', 'sweet', 'tomato', 'water', 'watermelon'],
    meanings:['è‹¹æœ', 'é¦™è•‰', 'è±†å­', 'é¢åŒ…', 'æ—©é¤', 'æ±‰å ¡åŒ…', 'è›‹ç³•', 'ç³–æœ', 'èåœ', 'å°é¸¡', 'è–¯ç‰‡C', 'å·§å…‹åŠ›', 'æ¤°å­', 'æ™šé¤', 'é¥®æ–™/å–', 'åƒ', 'é¸¡è›‹', 'é±¼', 'é£Ÿç‰©', 'è–¯ç‰‡F', 'æ°´æœ', 'è‘¡è„', 'é›ªç³•', 'æ±', 'çŒ•çŒ´æ¡ƒ', 'æŸ æª¬', 'æŸ æª¬æ±', 'é’æŸ æª¬', 'åˆé¤', 'èŠ’æœ', 'è‚‰ç±»', 'è‚‰ä¸¸', 'ç‰›å¥¶', 'æ´‹è‘±', 'æ¡”è‰²', 'è±Œè±†', 'æ¢¨', 'é¦…é¥¼', 'è è', 'åœŸè±†', 'ç±³é¥­', 'é¦™è‚ ', 'ç³–æœ', 'ç•ªèŒ„', 'æ°´', 'è¥¿ç“œ']
  },
  'The home':{
    words: ['apartment', 'armchair', 'bath', 'bathroom', 'bed', 'bedroom', 'bookcase', 'box', 'camera', 'chair', 'clock', 'computer', 'cupboard', 'desk', 'dining room', 'doll', 'door', 'flat', 'flower', 'garden', 'hall', 'home', 'house', 'kitchen', 'lamp', 'living room', 'mat', 'mirror', 'phone', 'picture', 'radio', 'room', 'rug', 'sleep', 'sofa', 'table', 'television', 'toy', 'tree', 'TV', 'wall', 'watch', 'window'],
    meanings:['å…¬å¯“A', 'æ‰¶æ‰‹æ¤…å­', 'æ²­æµ´', 'æµ´å®¤', 'åºŠ', 'å§å®¤', 'ä¹¦æ¶', 'ç›’å­', 'ç…§ç›¸æœº', 'æ¤…å­', 'æ—¶é’Ÿ', 'è®¡ç®—æœº', 'é£Ÿæ©±', 'ä¹¦æ¡Œ', 'é¥­å…', 'æ´‹å¨ƒå¨ƒ', 'é—¨', 'å…¬å¯“F', 'èŠ±', 'èŠ±å›­', 'é—¨å…', 'å®¶', 'æˆ¿å­', 'å¨æˆ¿', 'å°ç¯', 'å®¢å…', 'å«å­', 'é•œå­', 'ç”µè¯', 'å›¾ç”»', 'æ”¶éŸ³æœº', 'æˆ¿é—´', 'åœ°æ¯¯', 'ç¡è§‰', 'æ²™å‘', 'æ¡Œå­', 'ç”µè§†', 'ç©å…·', 'æ ‘', 'ç”µè§†', 'å¢™å£', 'æ‰‹è¡¨', 'çª—æˆ·']
  },
  Materials:{
    words: ['paper'],
    meanings:['çº¸']
  },
  Names:{
    words: ['Alex', 'Alice', 'Ann/Anna', 'Ben', 'Bill', 'Dan', 'Eva', 'Grace', 'Hugo', 'Jill', 'Kim', 'Lucy', 'Mark', 'Matt', 'May', 'Nick', 'Pat', 'Sam', 'Sue', 'Tom'],
    meanings:['Alex', 'Alice', 'Ann/Anna', 'Ben', 'Bill', 'Dan', 'Eva', 'Grace', 'Hugo', 'Jill', 'Kim', 'Lucy', 'Mark', 'Matt', 'May', 'Nick', 'Pat', 'Sam', 'Sue', 'Tom']
  },
  Numbers:{
    words: ['one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine', 'ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen', 'twenty'],
    meanings:['ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'ä¸ƒ', 'å…«', 'ä¹', 'å', 'åä¸€', 'åäºŒ', 'åä¸‰', 'åå››', 'åäº”', 'åå…­', 'åä¸ƒ', 'åå…«', 'åä¹', 'äºŒå']
  },
  'Places & directions':{
    words: ['behind', 'between', 'bookshop', 'end', 'here', 'in', 'in front of', 'on', 'park', 'playground', 'shop', 'store', 'street', 'there', 'under', 'zoo'],
    meanings:['åœ¨åé¢', 'åœ¨ä¸¤è€…ä¹‹é—´', 'ä¹¦åº—', 'ç»“æŸ', 'è¿™é‡Œ', 'åœ¨é‡Œé¢', 'åœ¨å‰é¢', 'åœ¨ä¸Šé¢', 'å…¬å›­', 'è¿åŠ¨åœº', 'å•†åº—SH', 'å•†åº—ST', 'è¡—é“', 'é‚£é‡Œ', 'åœ¨ä¸‹é¢', 'åŠ¨ç‰©å›­']
  },
  'School':{
    words: ['alphabet','answer','ask','board','book','bookcase','class','classroom','close','colour','computer','correct','crayon','cross','cupboard','desk','door','draw','English','eraser','example','find','floor','keyboard','learn','lesson','line','listen','look','mouse','music','number','open','page','painting','paper','part','pen','pencil','picture','playground','poster','question','read','right','rubber (US eraser)','ruler','school','sentence','sit','spell','stand','story','teacher','tell','tick','understand','wall','window','word','write'],
    meanings:['å­—æ¯','å›ç­”','é—®','æ¿','ä¹¦','ä¹¦æ¶','ç­çº§','æ•™å®¤','å…³é—­','é¢œè‰²','è®¡ç®—æœº','çº æ­£','èœ¡ç¬”','ç©¿è¿‡','é£Ÿæ©±','ä¹¦æ¡Œ','é—¨','ç”»ç”»','è‹±è¯­','æ©¡çš®æ“¦E-','ä¾‹å­','å‘ç°','åœ°æ¿','é”®ç›˜','å­¦ä¹ ','è¯¾','çº¿','å¬','çœ‹','é¼ æ ‡','éŸ³ä¹','æ•°å­—','æ‰“å¼€','é¡µæ•°','æ²¹ç”»','çº¸','éƒ¨åˆ†','é’¢ç¬”','é“…ç¬”','å›¾ç”»','è¿åŠ¨åœº','æµ·æŠ¥','é—®é¢˜','é˜…è¯»','æ­£ç¡®çš„','æ©¡çš®æ“¦R-','å°ºå­','å­¦æ ¡','å¥å­','å','æ‹¼å†™','ç«™','æ•…äº‹','è€å¸ˆ','å‘Šè¯‰','æ‰“å‹¾','ç†è§£','å¢™å£','çª—æˆ·','å•è¯','å†™']
  },
  'Sports & leisure':{
    words: ['badminton', 'ball', 'baseball', 'basketball', 'bat', 'beach', 'bike', 'boat', 'book', 'bounce', 'camera', 'catch ', 'doll', 'draw', 'drive', 'enjoy', 'favourite ', 'fishing', 'fly', 'football', 'game', 'guitar', 'hobby', 'hockey', 'jump', 'kick', 'kite', 'listen', 'music', 'photo', 'piano', 'picture', 'play', 'radio', 'read', 'ride', 'run', 'sing', 'skateboard', 'skateboarding', 'soccer', 'song', 'sport', 'story', 'swim', 'table tennis', 'take a photo/picture', 'television', 'tennis', 'tennis racket', 'throw', 'toy', 'walk', 'watch'],
    meanings:['ç¾½æ¯›çƒ', 'çƒ', 'æ£’çƒ', 'ç¯®çƒ', 'æ‹å­', 'æµ·æ»©', 'è‡ªè¡Œè½¦', 'å°èˆ¹', 'ä¹¦', 'è·³', 'ç…§ç›¸æœº', 'æ¥', 'æ´‹å¨ƒå¨ƒ', 'ç”»ç”»', 'é©¾è½¦', 'äº«å—', 'æœ€å–œæ¬¢çš„', 'é’“é±¼', 'è‹è‡', 'è¶³çƒ', 'æ¸¸æˆ', 'å‰ä»–', 'çˆ±å¥½', 'æ›²æ£çƒ', 'è·³è·ƒ', 'è¸¢', 'é£ç­', 'å¬', 'éŸ³ä¹', 'ç…§ç‰‡', 'é’¢ç´', 'å›¾ç”»', 'ç©è€', 'æ”¶éŸ³æœº', 'é˜…è¯»', 'ä¹˜å', 'å¥”è·‘', 'å”±', 'æºœå†°ç‰ˆ', 'è¶³çƒ', 'æ­Œæ›²', 'è¿åŠ¨', 'æ•…äº‹', 'æ¸¸æ³³', 'ä¹’ä¹“çƒ', 'ç…§ç›¸', 'ç…§ç›¸', 'ç”µè§†', 'ç½‘çƒ', 'ç½‘çƒæ‹', 'æŠ•', 'ç©å…·', 'æ•£æ­¥', 'æ‰‹è¡¨']
  },
  Time:{
    words: ['afternoon', 'birthday', 'clock', 'day', 'evening', 'in', 'morning', 'night', 'today', 'watch', 'year'],
    meanings:['ä¸‹åˆ', 'ç”Ÿæ—¥', 'æ—¶é’Ÿ', 'ç™½å¤©', 'æ™šä¸Š', 'åœ¨é‡Œé¢', 'æ—©æ™¨', 'å¤œæ™š', 'ä»Šå¤©', 'æ‰‹è¡¨', 'å¹´']
  },
  Toys:{
    words: ['alien', 'ball', 'balloon', 'baseball', 'basketball', 'bike', 'board game', 'boat', 'car', 'doll', 'football', 'game', 'helicopter', 'lorry', 'monster', 'motorbike', 'plane', 'robot', 'soccer', 'teddy bear', 'toy', 'train', 'truck'],
    meanings:['å¤–æ˜Ÿäºº', 'çƒ', 'æ°”çƒ', 'æ£’çƒ', 'ç¯®çƒ', 'è‡ªè¡Œè½¦', 'æ£‹ç±»æ¸¸æˆ', 'å°èˆ¹', 'æ±½è½¦', 'æ´‹å¨ƒå¨ƒ', 'è¶³çƒ', 'æ¸¸æˆ', 'ç›´å‡é£æœº', 'å¡è½¦L', 'æ€ªç‰©', 'æ‘©æ‰˜è½¦', 'é£æœº', 'æœºå™¨äºº', 'è¶³çƒ', 'ç†Š', 'ç©å…·', 'ç«è½¦', 'å¡è½¦T']
  },
  Transport:{
    words: ['bike', 'boat', 'bus', 'car', 'drive', 'fly', 'go', 'helicopter', 'lorry', 'plane', 'ride', 'run', 'ship', 'swim', 'train', 'truck'],
    meanings:['è‡ªè¡Œè½¦', 'å°èˆ¹', 'å…¬å…±æ±½è½¦', 'æ±½è½¦', 'é©¾è½¦', 'è‹è‡', 'è·‘', 'ç›´å‡é£æœº', 'å¡è½¦L', 'é£æœº', 'ä¹˜å', 'å¥”è·‘', 'å¤§èˆ¹', 'æ¸¸æ³³', 'ç«è½¦', 'å¡è½¦T']
  },
  Weather:{
    words: ['sun'],
    meanings:['å¤ªé˜³']
  },
  Work:{
    words: ['teacher'],
    meanings:['è€å¸ˆ']
  },
  'The world around us':{
    words: ['beach', 'sand', 'sea', 'shell', 'street', 'sun', 'tree', 'water'],
    meanings:['æµ·æ»©', 'æ²™å­', 'æµ·æ´‹', 'è´å£³', 'è¡—é“', 'å¤ªé˜³', 'æ ‘', 'æ°´']
  }
};

/* ========== è¯­éŸ³ ========== */
function speakWord(w) {
  const u = new SpeechSynthesisUtterance(w);
  u.lang = 'en-US';
  u.rate = 0.8;

  const voices = speechSynthesis.getVoices();
  // ä¼˜å…ˆé€‰æ‹©ç¾å¼è‹±è¯­å¥³å£° Samantha æˆ– Siri4
  u.voice = voices.find(voice =>
      voice.name === 'Samantha' || voice.name === 'Siri Female 4');

  speechSynthesis.speak(u);
}

/* ========== é¡µé¢åˆ‡æ¢ ========== */
function showSection(sec) {
  document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById(sec).classList.add('active');
  event.target.classList.add('active');
}

/* ========== å›åˆ°é¡¶éƒ¨ ========== */
function scrollToTop() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
}
window.onscroll = () => {
  document.getElementById('backToTop').style.display = window.pageYOffset > 200 ? 'block' : 'none';
};

/* ========== åˆå§‹åŒ– ========== */
let currentCategory = '';
let quizUsed = [], spellUsed = [];
let quizStats = {t:0,c:0,w:0}, spellStats = {t:0,c:0,w:0};
let currentQuizWord = '', currentSpellWord = '';
let usedLetters = [];
let spellStart = 0;
let wrongWords = []; // æ–°å¢ï¼šç”¨äºå­˜å‚¨ç­”é”™çš„å•è¯
let currentSpellingMode = 'normal'; // æ–°å¢ï¼šæ‹¼å†™æ¨¡å¼ï¼Œ'normal' æˆ– 'review'
let quizWrongWords = []; // æ–°å¢ï¼šç”¨äºå­˜å‚¨å°æµ‹ç­”é”™çš„å•è¯
let currentQuizMode = 'normal'; // æ–°å¢ï¼šå°æµ‹æ¨¡å¼ï¼Œ'normal' æˆ– 'review'

(function init() {
  if (navigator.storage && navigator.storage.persist) navigator.storage.persist();
  loadCategories();
})();

function loadCategories() {
  const lc = document.getElementById('learningCategories');
  const qc = document.getElementById('quizCategory');
  const sc = document.getElementById('spellingCategory');
  lc.innerHTML = ''; qc.innerHTML = ''; sc.innerHTML = '';
  for (const cat in wordData) {
    const btn = document.createElement('button'); btn.className = 'category-btn'; btn.textContent = cat;
    btn.onclick = () => selectLearningCategory(cat);
    lc.appendChild(btn);
    [qc, sc].forEach(sel => { const o = document.createElement('option'); o.value = cat; o.textContent = cat; sel.appendChild(o); });
  }
  sc.onchange = fillStartWord;
  fillStartWord();
}

function fillStartWord() {
  const cat = document.getElementById('spellingCategory').value;
  const sel = document.getElementById('startWord');
  sel.innerHTML = '';
  if (!cat) return;
  const data = wordData[cat];
  data.words.forEach((w, i) => {
    const o = document.createElement('option');
    o.value = i;
    o.textContent = data.meanings[i];   // åªæ˜¾ç¤ºä¸­æ–‡
    sel.appendChild(o);
  });
}

/* ========== å­¦ä¹ é¡µï¼šè‹±æ–‡é»‘è‰²å±…å·¦ï¼Œä¸­æ–‡æ·±è“å±…å³ ========== */
function selectLearningCategory(cat) {
  currentCategory = cat;
  document.querySelectorAll('.category-btn').forEach(b => b.classList.toggle('selected', b.textContent === cat));
  const data = wordData[cat];
  const list = document.getElementById('wordList'); list.innerHTML = '';
  data.words.forEach((w, i) => {
    const row = document.createElement('div'); row.className = 'word-item-row';
    const en = document.createElement('span'); en.className = 'word-en'; en.textContent = w;
    const cn = document.createElement('span'); cn.className = 'word-cn'; cn.textContent = data.meanings[i];
    row.appendChild(en); row.appendChild(cn);
    row.onclick = () => speakWord(w);
    list.appendChild(row);
  });
}

/* ========== æµ‹è¯•ï¼šæäº¤åé”æŒ‰é’® ========== */
function startQuiz(mode = 'normal') { // ä¿®æ”¹å‡½æ•°ç­¾åä»¥æ¥å—æ¨¡å¼å‚æ•°
  quizUsed = [];
  quizStats = {t:0,c:0,w:0};
  updateQuizStats();
  currentQuizMode = mode; // è®¾ç½®å°æµ‹æ¨¡å¼
  document.getElementById('quizContent').style.display = 'block';

  // å¦‚æœæ˜¯å¤ä¹ æ¨¡å¼ä¸”æ²¡æœ‰é”™é¢˜ï¼Œåˆ™ä¸å¼€å§‹ï¼Œå¹¶æç¤ºç”¨æˆ·
  if (currentQuizMode === 'review' && quizWrongWords.length === 0) {
    alert('å½“å‰æ²¡æœ‰é”™é¢˜å¯ä»¥å¤ä¹ ï¼');
    document.getElementById('quizContent').style.display = 'none';
    return;
  }
  nextQuiz();
}

function nextQuiz(isRetry = false) {
  // é‡æ–°å¯ç”¨æŒ‰é’®å’Œæ¸…é™¤æ¶ˆæ¯
  document.querySelectorAll('#quizOptionsContainer .quiz-option').forEach(b => {
    b.style.pointerEvents = '';
    b.classList.remove('correct', 'wrong');
  });
  document.getElementById('quizQuestion').innerHTML = '';
  document.getElementById('quizOptionsContainer').innerHTML = '';
  document.getElementById('quizMessage').innerHTML = ''; // æ¸…é™¤ quizMessage åŒºåŸŸå†…å®¹

  const cat = document.getElementById('quizCategory').value;
  const mode = document.getElementById('quizMode').value;
  const n = +document.getElementById('quizOptions').value;
  if (!cat) return;
  const data = wordData[cat];
  let idx;

  if (isRetry) {
    if (currentQuizMode === 'review') {
      const lastWord = quizUsed[quizUsed.length - 1];
      idx = data.words.indexOf(lastWord);
    } else {
      idx = quizUsed[quizUsed.length - 1];
    }
  } else if (currentQuizMode === 'review' && quizWrongWords.length > 0) {
    const availableWrongWords = quizWrongWords.filter(w => !quizUsed.includes(w));
    if (availableWrongWords.length === 0) {
      alert('æ‰€æœ‰å°æµ‹é”™é¢˜å·²å¤ä¹ å®Œæˆï¼');
      document.getElementById('quizContent').style.display = 'none';
      return;
    }
    const wordToReview = availableWrongWords[Math.floor(Math.random() * availableWrongWords.length)];
    idx = data.words.indexOf(wordToReview);
    quizUsed.push(wordToReview);
  } else {
    const avail = data.words.map((_, i) => i).filter(i => !quizUsed.includes(i));
    if (avail.length === 0) { alert('æœ¬åˆ†ç±»æµ‹è¯•å®Œæˆï¼'); return; }
    idx = avail[Math.floor(Math.random() * avail.length)];
    quizUsed.push(idx);
  }

  const word = data.words[idx], meaning = data.meanings[idx];
  currentQuizWord = word;

  const qDiv = document.getElementById('quizQuestion'), oc = document.getElementById('quizOptionsContainer');
  oc.innerHTML = '';
  // Clear previous quiz option styles
  document.querySelectorAll('#quizOptionsContainer .quiz-option').forEach(b => {
    b.classList.remove('correct', 'wrong');
  });

  const others = data.words.map((w, i) => ({w, m: data.meanings[i], i})).filter(x => x.i !== idx);
  const shuffle = [...others].sort(() => Math.random() - 0.5).slice(0, n - 1);
  if (mode === 'cn2en') {
    qDiv.textContent = `ä¸­æ–‡ï¼š${meaning}`;
    const opts = [word, ...shuffle.map(x => x.w)].sort(() => Math.random() - 0.5);
    opts.forEach(opt => {
      const b = document.createElement('div'); b.className = 'quiz-option'; b.textContent = opt;
      b.onclick = () => checkQuiz(opt === word, b);
      oc.appendChild(b);
    });
  } else {
    qDiv.innerHTML = `è‹±æ–‡ï¼š<span style="cursor:pointer" onclick="speakWord('${word}')">${word} ğŸ”Š</span>`;
    const opts = [meaning, ...shuffle.map(x => x.m)].sort(() => Math.random() - 0.5);
    opts.forEach(opt => {
      const b = document.createElement('div'); b.className = 'quiz-option'; b.textContent = opt;
      b.onclick = () => checkQuiz(opt === meaning, b);
      oc.appendChild(b);
    });
  }
}
function checkQuiz(correct, btn) {
  document.querySelectorAll('#quizOptionsContainer .quiz-option').forEach(b => b.style.pointerEvents = 'none');
  quizStats.t++;
  correct ? quizStats.c++ : quizStats.w++;
  updateQuizStats();
  btn.classList.add(correct ? 'correct' : 'wrong');

  if (!correct) {
    const currentWordInEn = document.getElementById('quizMode').value === 'cn2en' ? currentQuizWord : wordData[document.getElementById('quizCategory').value].words[wordData[document.getElementById('quizCategory').value].meanings.indexOf(currentQuizWord)];
    if (!quizWrongWords.includes(currentWordInEn)) {
      quizWrongWords.push(currentWordInEn);
      updateQuizWrongWordsDisplay();
    }
    document.querySelectorAll('#quizOptionsContainer .quiz-option').forEach(b => { if (b.textContent === (document.getElementById('quizMode').value === 'cn2en' ? currentQuizWord : wordData[document.getElementById('quizCategory').value].meanings[wordData[document.getElementById('quizCategory').value].words.indexOf(currentQuizWord)])) b.classList.add('correct'); });
    // æä¾›å†ç­”ä¸€æ¬¡å’Œç»§ç»­ä¸‹ä¸€é¢˜çš„é€‰é¡¹
    const messageDiv = document.createElement('div');
    messageDiv.style.marginTop = '15px';
    messageDiv.innerHTML = `
      <button class="primary-btn" onclick="nextQuiz(true)" style="margin-right: 10px;">å†ç­”ä¸€æ¬¡</button>
      <button class="primary-btn" onclick="nextQuiz()">ç»§ç»­ä¸‹ä¸€é¢˜</button>
    `;
    document.getElementById('quizMessage').innerHTML = `<div class="message error">ç­”é”™äº†ï¼æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${document.getElementById('quizMode').value === 'cn2en' ? currentQuizWord : wordData[document.getElementById('quizCategory').value].meanings[wordData[document.getElementById('quizCategory').value].words.indexOf(currentQuizWord)]}</div>`;
    document.getElementById('quizMessage').appendChild(messageDiv);

    // åœ¨ç­”é”™åä¹Ÿæ·»åŠ ä¸€ä¸ªå»¶è¿Ÿï¼Œä»¥ä¾¿ç”¨æˆ·æŸ¥çœ‹ç»“æœå’Œé€‰æ‹©æ“ä½œ
    setTimeout(() => {
      document.querySelectorAll('#quizOptionsContainer .quiz-option').forEach(b => b.style.pointerEvents = '');
      // æ³¨æ„ï¼šè¿™é‡Œä¸å†ç›´æ¥è°ƒç”¨ nextQuiz()ï¼Œè€Œæ˜¯ä¾èµ–ç”¨æˆ·ç‚¹å‡»â€œå†ç­”ä¸€æ¬¡â€æˆ–â€œç»§ç»­ä¸‹ä¸€é¢˜â€
    }, 1500);

  } else {
    // å¦‚æœæ˜¯å¤ä¹ æ¨¡å¼ä¸”ç­”å¯¹äº†ï¼Œä»quizWrongWordsä¸­ç§»é™¤è¿™ä¸ªå•è¯
    if (currentQuizMode === 'review') {
      const currentWordInEn = document.getElementById('quizMode').value === 'cn2en' ? currentQuizWord : wordData[document.getElementById('quizCategory').value].words[wordData[document.getElementById('quizCategory').value].meanings.indexOf(currentQuizWord)];
      const index = quizWrongWords.indexOf(currentWordInEn);
      if (index > -1) {
        quizWrongWords.splice(index, 1);
        updateQuizWrongWordsDisplay();
      }
    }
    document.getElementById('quizMessage').innerHTML = `<div class="message success">ç­”å¯¹äº†ï¼</div>`;
    setTimeout(() => {
      document.querySelectorAll('#quizOptionsContainer .quiz-option').forEach(b => b.style.pointerEvents = '');
      nextQuiz();
    }, 1500);
  }
}
function updateQuizStats() {
  document.getElementById('quizTotal').textContent = quizStats.t;
  document.getElementById('quizCorrect').textContent = quizStats.c;
  document.getElementById('quizWrong').textContent = quizStats.w;
  document.getElementById('quizRate').textContent = (quizStats.t ? Math.round(quizStats.c / quizStats.t * 100) : 0) + '%';
}

function updateQuizWrongWordsDisplay() {
  const displayDiv = document.getElementById('quizWrongWordsDisplay');
  const listUl = document.getElementById('quizWrongWordsList');
  listUl.innerHTML = '';
  if (quizWrongWords.length > 0) {
    displayDiv.style.display = 'block';
    quizWrongWords.forEach(word => {
      const li = document.createElement('li');
      li.textContent = word;
      li.style.fontSize = '24px'; // è°ƒæ•´å­—å·
      li.style.marginBottom = '8px'; // å¢åŠ é—´è·
      listUl.appendChild(li);
    });
  } else {
    displayDiv.style.display = 'none';
  }
}

function updateWrongWordsDisplay() {
  const displayDiv = document.getElementById('wrongWordsDisplay');
  const listUl = document.getElementById('wrongWordsList');
  listUl.innerHTML = '';
  if (wrongWords.length > 0) {
    displayDiv.style.display = 'block';
    wrongWords.forEach(word => {
      const li = document.createElement('li');
      li.textContent = word;
      li.style.fontSize = '24px'; // è°ƒæ•´å­—å·
      li.style.marginBottom = '8px'; // å¢åŠ é—´è·
      listUl.appendChild(li);
    });
  } else {
    displayDiv.style.display = 'none';
  }
}

function clearQuizWrongWords() {
  quizWrongWords = [];
  alert('å°æµ‹é”™é¢˜å·²æ¸…ç©ºï¼');
  // é‡ç½®å°æµ‹æ¨¡å—çš„UI
  document.getElementById('quizContent').style.display = 'none';
  quizUsed = [];
  quizStats = {t:0,c:0,w:0};
  updateQuizStats();
  currentQuizMode = 'normal';
  document.querySelectorAll('#quizOptionsContainer .quiz-option').forEach(b => {
    b.style.pointerEvents = '';
    b.classList.remove('correct', 'wrong');
  });
  document.getElementById('quizQuestion').innerHTML = '';
  document.getElementById('quizOptionsContainer').innerHTML = '';
  document.getElementById('quizRate').textContent = '0%';
}

/* ========== æ‹¼å†™ï¼šæ¨ªçº¿ç‰ˆ+å¯å–æ¶ˆ+é”æŒ‰é’® ========== */
function startSpelling(mode = 'normal') {
  spellStart = +document.getElementById('startWord').value;
  spellUsed = [];
  spellStats = {t:0,c:0,w:0};
  updateSpellStats();
  currentSpellingMode = mode; // è®¾ç½®æ‹¼å†™æ¨¡å¼
  document.getElementById('spellingContent').style.display = 'block';
  // å¦‚æœæ˜¯å¤ä¹ æ¨¡å¼ä¸”æ²¡æœ‰é”™é¢˜ï¼Œåˆ™ä¸å¼€å§‹ï¼Œå¹¶æç¤ºç”¨æˆ·
  if (currentSpellingMode === 'review' && wrongWords.length === 0) {
    alert('å½“å‰æ²¡æœ‰é”™é¢˜å¯ä»¥å¤ä¹ ï¼');
    document.getElementById('spellingContent').style.display = 'none';
    return;
  }
  nextSpell();
}

function nextSpell(isRetry = false) {
  // é‡æ–°å¯ç”¨æŒ‰é’®å’Œæ¸…é™¤æ¶ˆæ¯
  document.querySelectorAll('#letterButtons .letter-btn').forEach(b => {
    b.style.pointerEvents = '';
    b.classList.remove('used'); // ç¡®ä¿æ¸…é™¤usedç±»
  });
  document.querySelector('#spellingContent .primary-btn').style.pointerEvents = '';
  document.getElementById('spellingMessage').innerHTML = '';

  const cat = document.getElementById('spellingCategory').value;
  const cas = document.getElementById('letterCase').value;
  const d = +document.getElementById('distractionLetters').value;
  if (!cat) return;
  const data = wordData[cat];
  let idx;
  // ä¿®æ­£ï¼šisReviewMode ç°åœ¨ä»å…¨å±€å˜é‡ currentSpellingMode è·å–
  // let isReviewMode = document.querySelector('[onclick="startSpelling(\'review\')"]').classList.contains('active'); // åˆ¤æ–­æ˜¯å¦æ˜¯å¤ä¹ æ¨¡å¼

  if (isRetry) {
    // å¦‚æœæ˜¯é‡è¯•ï¼Œä¸”æ˜¯å¤ä¹ æ¨¡å¼ï¼Œåˆ™ä»wrongWordsä¸­è·å–ä¸Šä¸€ä¸ªå•è¯
    if (currentSpellingMode === 'review') {
      const lastWord = spellUsed[spellUsed.length - 1];
      idx = data.words.indexOf(lastWord);
    } else {
      idx = spellUsed[spellUsed.length - 1]; // å¦‚æœæ˜¯é‡è¯•ï¼Œä½¿ç”¨ä¸Šä¸€ä¸ªå•è¯çš„ç´¢å¼•
    }
  } else if (currentSpellingMode === 'review' && wrongWords.length > 0) { // å¤ä¹ æ¨¡å¼
    // ç¡®ä¿ spellUsed åœ¨å¤ä¹ æ¨¡å¼ä¸‹å­˜å‚¨çš„æ˜¯å•è¯æœ¬èº«
    const availableWrongWords = wrongWords.filter(w => !spellUsed.includes(w));
    if (availableWrongWords.length === 0) {
      alert('æ‰€æœ‰é”™é¢˜å·²å¤ä¹ å®Œæˆï¼');
      // å¯ä»¥é€‰æ‹©é‡ç½®wrongWordsï¼Œæˆ–è€…é€€å‡ºå¤ä¹ æ¨¡å¼
      document.getElementById('spellingContent').style.display = 'none';
      return;
    }
    const wordToReview = availableWrongWords[Math.floor(Math.random() * availableWrongWords.length)];
    idx = data.words.indexOf(wordToReview);
    spellUsed.push(wordToReview); // åœ¨å¤ä¹ æ¨¡å¼ä¸‹ï¼ŒspellUsedå­˜å‚¨çš„æ˜¯å•è¯æœ¬èº«
  } else {
    idx = spellStart;
    while (idx < data.words.length && spellUsed.includes(idx)) idx++;
    if (idx >= data.words.length) { alert('æœ¬åˆ†ç±»æ‹¼å†™å®Œæˆï¼'); return; }
    spellUsed.push(idx);
  }

  const word = data.words[idx], meaning = data.meanings[idx];
  currentSpellWord = word;
  usedLetters = [];

  // ä¸­æ–‡æ ‡é¢˜ + å¡é€šå–‡å­ï¼ˆå±…ä¸­ï¼‰
  document.getElementById('spellingWord').className = 'spelling-title';
  document.getElementById('spellingWord').textContent = meaning;
  const speakerBtn = document.getElementById('spellingContent').querySelector('.cartoon-speaker');
  speakerBtn.textContent = 'ğŸº';
  speakerBtn.onclick = () => speakWord(currentSpellWord);

  // æ¨ªçº¿åŒºåŸŸ
  const display = document.getElementById('spellingDisplay');
  display.innerHTML = '';
  display.className = 'spelling-display-lines';
  word.split('').forEach(() => {
    const slot = document.createElement('div'); slot.className = 'letter-slot';
    display.appendChild(slot);
  });
  document.getElementById('spellingMessage').innerHTML = '';

  // å­—æ¯æ± 
  const pool = word.split('').map(l => cas === 'upper' ? l.toUpperCase() : l.toLowerCase());
  const allL = 'abcdefghijklmnopqrstuvwxyz'.split('').map(l => cas === 'upper' ? l.toUpperCase() : l);
  const dis = [];
  while (dis.length < d) {
    const l = allL[Math.floor(Math.random() * allL.length)];
    if (!pool.includes(l)) dis.push(l);
  }
  const buttons = [...pool, ...dis].sort(() => Math.random() - 0.5);
  const box = document.getElementById('letterButtons'); box.innerHTML = '';
  buttons.forEach(l => {
    const b = document.createElement('button'); b.className = 'letter-btn'; b.textContent = l;
    b.onclick = () => toggleLetter(l, b);
    box.appendChild(b);
  });
}
function toggleLetter(l, btn) {
  const slots = document.querySelectorAll('.letter-slot');

  // å¦‚æœæŒ‰é’®å·²ç”¨è¿‡ï¼šåªæ¸…ç©ºå®ƒè‡ªå·±å¯¹åº”çš„æœ€åä¸€ä¸ªæ§½
  if (btn.classList.contains('used')) {
    btn.classList.remove('used');
    // ä»åå¾€å‰æ‰¾æœ€åä¸€ä¸ªå¡«å…¥çš„ç›¸åŒå­—æ¯
    for (let i = slots.length - 1; i >= 0; i--) {
      if (slots[i].textContent === l) {
        slots[i].textContent = '';
        slots[i].classList.remove('filled');
        break;                  // åªæ¸…ä¸€ä¸ª
      }
    }
    return;
  }

  // é¦–æ¬¡ç‚¹å‡»ï¼šæ­£å¸¸å¡«å…¥ç©ºæ§½
  for (let s of slots) {
    if (!s.textContent) { s.textContent = l; s.classList.add('filled'); break; }
  }
  btn.classList.add('used');
}
function checkSpelling() {
  const slots = document.querySelectorAll('.letter-slot');
  const user = Array.from(slots).map(s => s.textContent).join('').toLowerCase();
  if (user.length !== currentSpellWord.length) return;
  document.querySelectorAll('#letterButtons .letter-btn').forEach(b => b.style.pointerEvents = 'none');
  document.querySelector('#spellingContent .primary-btn').style.pointerEvents = 'none';

  const correct = currentSpellWord.toLowerCase();
  const ok = user === correct;
  spellStats.t++;
  ok ? spellStats.c++ : spellStats.w++;
  updateSpellStats();
  const m = document.getElementById('spellingMessage');
  m.innerHTML = `<div class="message ${ok ? 'success' : 'error'}">${ok ? 'ç­”å¯¹äº†ï¼' : 'ç­”é”™äº†ï¼æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š' + currentSpellWord.toUpperCase()}</div>`;
  if (!ok) {
    wrongWords.push(currentSpellWord); // è®°å½•ç­”é”™çš„å•è¯
    updateWrongWordsDisplay(); // æ›´æ–°ç­”é”™å•è¯åˆ—è¡¨æ˜¾ç¤º
    m.innerHTML += `
      <div style="margin-top: 15px;">
        <button class="primary-btn" onclick="nextSpell(true)" style="margin-right: 10px;">å†ç­”ä¸€æ¬¡</button>
        <button class="primary-btn" onclick="nextSpell()">ç»§ç»­ä¸‹ä¸€é¢˜</button>
      </div>
    `;
  } else {
    // å¦‚æœæ˜¯å¤ä¹ æ¨¡å¼ä¸”ç­”å¯¹äº†ï¼Œä»wrongWordsä¸­ç§»é™¤è¿™ä¸ªå•è¯
    if (currentSpellingMode === 'review') {
      const index = wrongWords.indexOf(currentSpellWord);
      if (index > -1) {
        wrongWords.splice(index, 1);
        updateWrongWordsDisplay();
      }
    }
    setTimeout(() => {
      document.querySelectorAll('#letterButtons .letter-btn').forEach(b => b.style.pointerEvents = '');
      document.querySelector('#spellingContent .primary-btn').style.pointerEvents = '';
      nextSpell();
    }, 2000);
  }
}
function updateSpellStats() {
  document.getElementById('spellTotal').textContent = spellStats.t;
  document.getElementById('spellCorrect').textContent = spellStats.c;
  document.getElementById('spellWrong').textContent = spellStats.w;
  document.getElementById('spellRate').textContent = (spellStats.t ? Math.round(spellStats.c / spellStats.t * 100) : 0) + '%';
}

function clearWrongWords() {
  wrongWords = [];
  updateWrongWordsDisplay();
  alert('é”™é¢˜å·²æ¸…ç©ºï¼');
  // é‡ç½®æ‹¼å†™æ¨¡å—çš„UI
  document.getElementById('spellingContent').style.display = 'none';
  spellUsed = [];
  spellStats = {t:0,c:0,w:0};
  updateSpellStats();
  currentSpellingMode = 'normal';
  document.querySelectorAll('#letterButtons .letter-btn').forEach(b => {
    b.style.pointerEvents = '';
    b.classList.remove('used');
  });
  document.querySelector('#spellingContent .primary-btn').style.pointerEvents = '';
  document.getElementById('spellingMessage').innerHTML = '';
}
</script>
</body>
</html>